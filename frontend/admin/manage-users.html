<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Manage Users - Admin Panel</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; font-family: "Poppins", sans-serif; }
    body { min-height: 100vh; background: linear-gradient(135deg, #000000, #0a0a0a); color: #fff; }

    /* Navbar */
    .navbar {
      width: 100%; display: flex; justify-content: space-between; align-items: center;
      padding: 15px 40px; background: rgba(0, 0, 0, 0.8); backdrop-filter: blur(6px);
      position: fixed; top: 0; left: 0; z-index: 1000; box-shadow: 0 4px 10px rgba(0,0,0,0.5);
    }
    .navbar h1 { font-size: 24px; color: #00ffcc; letter-spacing: 1px; }
    .navbar ul { list-style: none; display: flex; gap: 20px; align-items: center; }
    .navbar ul li a { text-decoration: none; color: #fff; padding: 8px 12px; border-radius: 6px; transition: 0.3s; font-weight: 500; }
    #logoutBtn { background: #e53935; color: #fff; padding: 8px 15px; border-radius: 6px; transition: 0.3s ease; }
    #logoutBtn:hover { background: #ff4444; transform: scale(1.05); }

    /* Main */
    .main { margin-top: 110px; padding: 30px 40px; }
    .main h2 { color: #00ffcc; margin-bottom: 25px; text-align: center; }

    /* Table */
    table { width: 100%; border-collapse: collapse; background: rgba(255, 255, 255, 0.08); backdrop-filter: blur(8px); border-radius: 10px; overflow: hidden; box-shadow: 0 4px 20px rgba(0,0,0,0.4); }
    thead { background: rgba(0, 255, 204, 0.1); }
    th, td { padding: 14px 16px; text-align: left; color: #ddd; border-bottom: 1px solid rgba(255,255,255,0.1); }
    th { color: #00ffcc; text-transform: uppercase; font-size: 14px; letter-spacing: 0.5px; }
    tr:hover { background: rgba(255, 255, 255, 0.12); transition: 0.3s; }

    /* Action buttons */
    .btn-edit, .btn-delete { padding: 6px 12px; border: none; border-radius: 6px; cursor: pointer; font-weight: 500; transition: 0.3s ease; }
    .btn-edit { background: #00ffcc; color: #000; }
    .btn-edit:hover { background: #fff; }
    .btn-delete { background: #e53935; color: #fff; }
    .btn-delete:hover { background: #ff4444; transform: scale(1.05); }

    footer { margin-top: 50px; text-align: center; padding: 20px; background: rgba(0, 0, 0, 0.75); color: #aaa; font-size: 14px; letter-spacing: 0.5px; }

    @media (max-width: 768px) {
      table { font-size: 13px; }
      .navbar { flex-direction: column; align-items: flex-start; }
      .navbar ul { flex-wrap: wrap; gap: 10px; margin-top: 10px; }
      .main { padding: 20px; }
    }
  </style>
</head>
<body>

  <!-- Navbar -->
  <nav class="navbar">
    <h1>Manage Users</h1>
    <ul>
      <li><a href="index.html">Home</a></li>
      <li><a href="manage-users.html">Manage Users</a></li>
      <li><a href="product-listing.html">Product Listing</a></li>
      <li><a href="buy-approval.html">Buy Approvals</a></li>
      <li><a href="sell-approval.html">Sell Approvals</a></li>
      <li><a href="trade-approval.html">Trade Approvals</a></li>
      <li><a href="#" id="logoutBtn">Logout</a></li>
    </ul>
  </nav>

  <!-- Main Content -->
  <div class="main">
    <h2>Registered Users</h2>
    <table>
      <thead>
        <tr>
          <th>#</th>
          <th>Name</th>
          <th>Email</th>
          <th>Role</th>
          <th>Status</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody id="userTableBody">
        <!-- Users will be populated here -->
      </tbody>
    </table>
  </div>

  <footer>Â© 2025 Upstyle Marketplace | Manage Users</footer>

  <script>
    const userTableBody = document.getElementById('userTableBody');

    // Fetch users from backend
    async function fetchUsers() {
      try {
        const res = await fetch('http://localhost:5000/api/auth/users');
        const users = await res.json();

        if (!Array.isArray(users)) throw new Error("Invalid response format");

        userTableBody.innerHTML = '';
        users.forEach((user, index) => {
          const tr = document.createElement('tr');
          tr.innerHTML = `
            <td>${index + 1}</td>
            <td>${user.name}</td>
            <td>${user.email}</td>
            <td>${user.role}</td>
            <td>${user.status || 'Active'}</td>
            <td>
              <button class="btn-edit" data-id="${user._id}">Edit</button>
              <button class="btn-delete" data-id="${user._id}">Delete</button>
            </td>
          `;
          userTableBody.appendChild(tr);
        });

        attachActions();
      } catch (err) {
        console.error('Error fetching users:', err);
        userTableBody.innerHTML = `<tr><td colspan="6">Failed to load users</td></tr>`;
      }
    }

    // Attach edit/delete actions
    function attachActions() {
      // Delete user
      document.querySelectorAll('.btn-delete').forEach(btn => {
        btn.addEventListener('click', async () => {
          const userId = btn.dataset.id;
          if (!confirm('Are you sure you want to delete this user?')) return;

          try {
            const res = await fetch(`http://localhost:5000/api/auth/users/${userId}`, { method: 'DELETE' });
            if (res.ok) fetchUsers();
            else alert('Failed to delete user');
          } catch (err) {
            console.error(err);
            alert('Server error');
          }
        });
      });

      // Edit user placeholder
      document.querySelectorAll('.btn-edit').forEach(btn => {
        btn.addEventListener('click', () => {
          alert(`Edit user ${btn.dataset.id} (implement your edit form)`);
        });
      });
    }

    // Logout
    document.getElementById('logoutBtn').addEventListener('click', () => {
      if (confirm("Are you sure you want to logout?")) {
        localStorage.removeItem('token');
        localStorage.removeItem('user');
        window.location.href = '../index.html';
      }
    });

    // Initial fetch
    fetchUsers();
  </script>

</body>
</html>

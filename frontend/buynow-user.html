<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Buy Now - User</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:"Poppins",sans-serif;}
body{min-height:100vh;background:#111;color:#fff;display:flex;flex-direction:column;}
.navbar{width:100%;display:flex;justify-content:space-between;align-items:center;padding:15px 40px;background:rgba(0,0,0,0.85);backdrop-filter:blur(6px);}
.navbar h2{color:#00ffcc;}
.navbar ul{list-style:none;display:flex;gap:20px;}
.navbar ul li a, .navbar ul li button{color:#fff;text-decoration:none;padding:8px 12px;border-radius:6px;cursor:pointer;border:none;background:none;}
.navbar ul li button:hover, .navbar ul li a:hover{background:#00cc99;color:#000;}
.page-title{text-align:center;margin-top:100px;font-size:28px;color:#00ffcc;}
.section-title{margin:30px 50px 10px;font-size:22px;color:#00ffcc;}
.scroll-container{display:flex;gap:20px;overflow-x:auto;padding:20px 50px;}
.scroll-container::-webkit-scrollbar{display:none;}
.product-card{flex:0 0 250px;background:rgba(255,255,255,0.1);border-radius:15px;padding:15px;display:flex;flex-direction:column;align-items:center;height:480px;backdrop-filter:blur(8px);}
.product-card:hover{transform:translateY(-5px);background:rgba(0,255,204,0.1);}
.product-card img{width:100%;height:200px;border-radius:10px;object-fit:cover;margin-bottom:10px;}
.product-card h3{color:#00ffcc;margin-bottom:5px;}
.product-card p{color:#ddd;font-size:14px;flex-grow:1;overflow:hidden;margin-bottom:10px;line-height:1.3;}
.product-card .price{margin-top:5px;font-weight:bold;color:#fff;}
.buy-btn{margin-top:auto;padding:10px 20px;border-radius:8px;cursor:pointer;background:#00ffcc;color:#000;font-weight:500;transition:0.3s;}
.buy-btn:hover{background:#00cc99;transform:scale(1.05);}
footer{margin-top:auto;padding:15px;text-align:center;background:rgba(0,0,0,0.7);color:#ccc;}
</style>
</head>
<body>

<nav class="navbar">
  <h2>UpStyle Marketplace</h2>
  <ul>
    <li><a href="home.html">Home</a></li>
    <li><a href="buy.html">Buy</a></li>
    <li><a href="sell.html">Sell</a></li>
    <li><a href="trade.html">Trade</a></li>
    <li><button id="logoutBtn">Logout</button></li>
  </ul>
</nav>

<div class="page-title">Buy Products</div>

<h2 class="section-title">Featured Products</h2>
<div id="buyGrid" class="scroll-container"></div>

<footer>© 2025 UpStyle Marketplace | ♻️</footer>

<script>
const logoutBtn = document.getElementById('logoutBtn');
logoutBtn.addEventListener('click', ()=>{
  localStorage.removeItem('user');
  localStorage.removeItem('token');
  window.location.href='index.html';
});

async function fetchProducts(){
  try{
    const res = await fetch('http://localhost:5000/api/products');
    const products = await res.json();
    renderProducts(products,'buyGrid');
  }catch(err){ alert('Error fetching products: '+err.message); }
}

function renderProducts(products,containerId){
  const container = document.getElementById(containerId);
  if(products.length===0) container.innerHTML='<p style="color:#aaa;text-align:center;">No products available.</p>';
  else container.innerHTML = products.map(p=>`
    <div class="product-card">
      <img src="${p.image}" alt="${p.title}">
      <h3>${p.title}</h3>
      <p>${p.description||p.condition||''}</p>
      <div class="price">${p.price?'₹'+p.price:''}</div>
      <button class="buy-btn" onclick="buyNow('${p._id}','${p.title}',${p.price||0})">Buy Now</button>
    </div>
  `).join('');
}

async function buyNow(productId,title,price){
  const user = JSON.parse(localStorage.getItem('user'));
  if(!user) return alert('Please login first!');
  try{
    const res = await fetch('http://localhost:5000/api/orders',{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify({
        user:user.username,
        productId,
        productTitle:title,
        price
      })
    });
    const data = await res.json();
    if(res.ok) alert(`✅ You bought "${title}" successfully!`);
    else alert('❌ Error: '+data.error);
  }catch(err){ alert('❌ Network error: '+err.message); }
}

fetchProducts();
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Buy - UpStyle Marketplace</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
* { margin:0; padding:0; box-sizing:border-box; font-family:"Poppins", sans-serif; }
body { min-height:100vh; background: linear-gradient(to right, black, #868585); color:#fff; display:flex; flex-direction:column; }

/* Navbar */
.navbar {
  width:100%; display:flex; justify-content:space-between; align-items:center;
  padding:15px 50px; position:fixed; top:0; left:0;
  background:rgba(0,0,0,0.8); backdrop-filter: blur(8px);
  z-index:1000; box-shadow: 0 4px 10px rgba(0,0,0,0.4);
}
.navbar h2 { color:#00ffcc; font-size:26px; font-weight:700; }
.navbar ul { list-style:none; display:flex; align-items:center; gap:25px; }
.navbar ul li a { text-decoration:none; color:#fff; font-weight:500; font-size:16px; padding:6px 12px; border-radius:5px; transition:0.3s; }

.navbar ul li button { padding:8px 16px; border:none; border-radius:6px; background:#ff4d4d; color:#fff; cursor:pointer; font-weight:500; transition:0.3s; }
.navbar ul li button:hover { background:#cc0000; }

.page-title { margin-top:140px; text-align:center; font-size:30px; font-weight:700; color:#00ffcc; text-shadow: 2px 2px 6px rgba(0,0,0,0.6); }
h2.section-title { text-align:left; margin:50px 60px 15px; color:#00ffcc; font-size:22px; text-shadow: 1px 1px 5px rgba(0,0,0,0.5); }

/* Product containers */
.scroll-container {
  display:flex; gap:20px; overflow-x:auto; scroll-behavior:smooth;
  padding:20px 60px; scrollbar-width:none;
}
.scroll-container::-webkit-scrollbar { display:none; }

.product-card {
  flex:0 0 250px; background: rgba(255,255,255,0.1); border-radius:15px;
  padding:15px; display:flex; flex-direction:column;
  justify-content:space-between; align-items:center; text-align:center;
  backdrop-filter:blur(8px); transition:0.3s;
  box-shadow:0 4px 20px rgba(0,0,0,0.3); height:480px;
}
.product-card:hover { transform: translateY(-10px); background: rgba(0, 0, 0, 0.2); }
.product-card img { width:100%; height:200px; border-radius:10px; object-fit:cover; margin-bottom:10px; }
.product-card h3 { color:#00ffcc; margin-bottom:5px; font-size:18px; min-height:24px; }
.product-card p { color:#ddd; font-size:14px; flex-grow:1; overflow:hidden; margin-bottom:10px; line-height:1.3; }
.product-card .price { margin-top:5px; color:#fff; font-weight:bold; }
.buy-btn {
  margin-top:auto; padding:10px 20px; font-size:14px; color:#000;
  background:#00ffcc; border:none; border-radius:8px; cursor:pointer; transition:0.3s;
}
.buy-btn:hover { background:#00cc99; transform:scale(1.05); }

footer { margin-top:auto; background: rgba(0,0,0,0.7); text-align:center; padding:15px; color:#ccc; font-size:14px; }

/* Toast Notification */
#toastContainer {
  position:fixed; top:30px; right:30px;
  display:flex; flex-direction:column; gap:10px;
  z-index:2000;
}
.toast {
  background:#222; color:#fff; padding:12px 20px; border-radius:8px;
  box-shadow:0 3px 8px rgba(0,0,0,0.4);
  animation: slideIn 0.4s ease, fadeOut 0.4s ease 2.6s forwards;
  font-size:14px; min-width:220px;
}
.toast.success { border-left:5px solid #00ff99; }
.toast.error { border-left:5px solid #ff4d4d; }

@keyframes slideIn {
  from { opacity:0; transform: translateX(100%); }
  to { opacity:1; transform: translateX(0); }
}
@keyframes fadeOut {
  to { opacity:0; transform: translateX(100%); }
}
</style>
</head>
<body>

<nav class="navbar">
  <h2>UpStyle Marketplace</h2>
  <ul>
    <li><a href="home.html">Home</a></li>
    <li><a href="buy.html">Buy</a></li>
    <li><a href="sell.html">Sell</a></li>
    <li><a href="trade.html">Trade</a></li>
    <li><a href="cart.html">üõí Cart <span id="cartCount" style="background:#a5c6bf;color:#000;padding:2px 6px;border-radius:25%;font-size:12px;">0</span></a></li>
    <li><button id="logoutBtn">Logout</button></li>
  </ul>
</nav>

<div class="page-title">Buy Upcycled Products</div>

<h2 class="section-title">Featured Products</h2>
<div id="buyGrid" class="scroll-container"></div>

<h2 class="section-title">Sell Products</h2>
<div id="sellGrid" class="scroll-container"></div>

<h2 class="section-title">Trade Products</h2>
<div id="tradeGrid" class="scroll-container"></div>

<footer>¬© 2025 UpStyle Marketplace | Designed with ‚ôªÔ∏è Sustainable Innovation</footer>

<!-- Toast container -->
<div id="toastContainer"></div>

<script>
const userId = "guest123";

// ‚úÖ Toast Function
function showToast(message, type="success") {
  const container = document.getElementById("toastContainer");
  const toast = document.createElement("div");
  toast.className = `toast ${type}`;
  toast.textContent = message;
  container.appendChild(toast);
  setTimeout(() => toast.remove(), 3000);
}

// ‚úÖ Logout
document.getElementById("logoutBtn").addEventListener("click", () => {
  window.location.href = "index.html";
});

// ‚úÖ Cart Count
async function updateCartCount() {
  try {
    const res = await fetch(`http://localhost:5000/api/cart/${userId}`);
    const data = await res.json();
    document.getElementById("cartCount").textContent = data.length || 0;
  } catch {
    document.getElementById("cartCount").textContent = 0;
  }
}
updateCartCount();

// ‚úÖ Add to Cart (works for Featured, Sell, Trade products)
async function addToCart(product) {
  try {
    const payload = {
      userId,
      productId: product._id || product.id || product.tradeId,
      name: product.title || product.name || product.tradeTitle || "Untitled Product",
      price: product.price || 0,  // Trade products have no price
      image: product.image || product.tradeImage || "",
    };

    const res = await fetch("http://localhost:5000/api/cart/add", { 
      method: "POST", 
      headers: { "Content-Type": "application/json" }, 
      body: JSON.stringify(payload)
    });

    if (!res.ok) throw new Error("Failed");

    showToast(`‚úÖ ${payload.name} added to cart!`, "success");
    updateCartCount();
  } catch (err) { 
    showToast("‚ùå Failed to add product", "error");
    console.error("Add to Cart error:", err); 
  }
}

// ‚úÖ Render Product Cards
function renderGrid(products, containerId) {
  const container = document.getElementById(containerId);
  container.innerHTML = !products.length 
    ? `<p style="text-align:center;color:#aaa;">No products available.</p>` 
    : products.map((p, i) => `
      <div class="product-card">
        <img src="${p.image || p.tradeImage}" alt="${p.title || p.tradeTitle}">
        <h3>${p.title || p.tradeTitle}</h3>
        <p>${p.description || p.tradeDescription || ''}</p>
        ${containerId !== "tradeGrid" ? `<div class="price">‚Çπ${p.price || 0}</div>` : ''}
        <button class="buy-btn" id="buyBtn-${containerId}-${i}">Buy Now</button>
      </div>
    `).join('');

  products.forEach((p, i) => {
    document.getElementById(`buyBtn-${containerId}-${i}`)
      .addEventListener('click', () => addToCart(p));
  });
}

// ‚úÖ Load All Product Categories
async function loadProducts() {
  try {
    const featuredRes = await fetch("http://localhost:5000/api/admin/featured");
    const sellRes = await fetch("http://localhost:5000/api/sell");
    const tradeRes = await fetch("http://localhost:5000/api/trades");

    const featured = (await featuredRes.json()).filter(p => p.status?.toLowerCase() === 'approved');
    const sell = (await sellRes.json()).filter(p => p.status?.toLowerCase() === 'approved' && p.sellerName?.toLowerCase() !== 'admin');
    const trade = (await tradeRes.json()).filter(p => p.status?.toLowerCase() === 'approved');

    renderGrid(featured, "buyGrid");
    renderGrid(sell, "sellGrid");
    renderGrid(trade, "tradeGrid");
  } catch (err) { 
    console.error("Failed to load products:", err); 
  }
}

loadProducts();
</script>

</body>
</html>
